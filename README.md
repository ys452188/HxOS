# HxOS - 极简 x86 业余操作系统内核  By CuSO4isVeryNice

HxOS 是一个从零开始开发的、运行在 x86 架构上的 32 位爱好者操作系统内核。本项目实现了从 BIOS 引导、开启 A20 总线、进入保护模式，到内核 C 语言环境运行的完整链条。

## 🚀 项目特性

* **自主引导**：自定义汇编引导程序（Bootloader），不依赖 GRUB。
* **混合编程**：引导部分使用 NASM 汇编，内核主体使用 C 语言编写。
* **内存布局**：精确控制的链接脚本，确保内核加载至物理内存 `1MB` 处。
* **VGA 驱动**：支持文本模式下的屏幕清屏、单字符输出及字符串格式化输出。
* **键盘驱动**：实现基于轮询模式的 PS/2 键盘输入处理。
* **构建系统**：基于 LLVM 链（Clang, lld, llvm-objcopy）的构建脚本。

## 📂 目录结构

| 文件 | 描述 |
| --- | --- |
| `src/Bootloader.asm` | 引导程序，负责 16 位到 32 位跳转及内核加载 |
| `src/Kernel.c` | 内核入口点 `kmain` 所在地，包含 BSS 清理逻辑 |
| `src/VGA.h` | 字符缓冲区驱动，处理 0xB8000 地址处的显存写入 |
| `src/Keyboard.h` | 键盘扫描码映射及简单的 IO 轮询实现 |
| `src/Inout.h` | 封装了汇编指令 `in` 和 `out` 的内联函数 |
| `linker.ld` | 链接脚本，定义内存布局，解决稀疏镜像问题 |
| `编译.sh` | 自动构建脚本，从源码到生成 ISO 镜像 |

## 🛠️ 环境依赖

在编译本项目之前，请确保您的开发环境已安装以下工具：

* **编译器**: `Clang` (支持交叉编译为 `i386-pc-none-elf`)
* **汇编器**: `NASM`
* **链接器**: `ld.lld` (LLVM 链接器)
* **工具链**: `llvm-objcopy`
* **镜像制作**: `xorriso` (用于生成 .iso 镜像)
* **模拟器**: `QEMU` (用于运行和调试)

## 🔨 构建与运行

1. **赋予脚本执行权限**:
```bash
chmod +x 编译.sh

```
2. **编译**:
该脚本会自动完成内核编译、链接、裸二进制转换及 ISO 镜像合成。
```bash
./编译.sh

```
3. **使用 QEMU 运行**:
```bash
qemu-system-i386 -cdrom HxOS.iso

```
## ⚠️ 开发注意事项（避坑指南）

* **SSE 异常**: 内核编译时必须开启 `-mno-sse` 选项，否则 Clang 优化的向量化指令会导致未初始化 SSE 寄存器的环境下发生 Triple Fault。
* **BSS 段初始化**: 裸二进制文件（.bin）不包含 BSS 段，必须在 `kmain` 开始处手动调用 `clean_bss()`。
* **内存对齐**: 在链接脚本中避免对 `.text` 以外的段过度使用 `ALIGN(4K)`，以减小镜像体积并防止地址偏移错乱。

## 📜 许可证
